{"version":3,"file":"rollup-plugin-babel-minify.js","sources":["../src/utils.js","../src/index.js"],"sourcesContent":["import MagicString from 'magic-string';\nimport semver from 'semver';\n\nfunction addNewLine( code ) {\n\tconst magicString = new MagicString( code );\n\tconst bannerEnd = code.indexOf( '*/' );\n\n\tmagicString.appendRight( bannerEnd + 2, '\\n' );\n\n\tconst map = magicString.generateMap( {\n\t\tincludeContent: true\n\t} );\n\n\treturn {\n\t\tcode: magicString.toString(),\n\t\tmap\n\t};\n}\n\nfunction filterMinifyOptions( options ) {\n\tconst disallowedProperties = [\n\t\t'banner',\n\t\t'bannerNewLine',\n\t\t'sourceMap',\n\t\t'comments'\n\t];\n\tconst minifyOptions = {};\n\n\tObject.keys( options ).filter( ( option ) => {\n\t\tif ( disallowedProperties.indexOf( option ) === -1 ) {\n\t\t\tminifyOptions[ option ] = options[ option ];\n\t\t}\n\t} );\n\n\treturn minifyOptions;\n}\n\nfunction isString( v ) {\n\treturn v != null && typeof v === 'string';\n}\n\nfunction isFn( v ) {\n\treturn v != null && typeof v === 'function';\n}\n\nfunction isFnOrString( v ) {\n\treturn isString( v ) || isFn( v );\n}\n\nfunction checkNodeVersion() {\n\treturn semver.satisfies( process.version, '>=6.0.0' );\n}\n\nexport { addNewLine };\nexport { filterMinifyOptions };\nexport { isString };\nexport { isFn };\nexport { isFnOrString };\nexport { checkNodeVersion };\n","'use strict';\n\nimport { filterMinifyOptions } from './utils.js';\nimport { addNewLine } from './utils.js';\nimport { isFn } from './utils.js';\nimport { isFnOrString } from './utils.js';\nimport { checkNodeVersion } from './utils.js';\nimport depd from 'depd';\nimport minifyPreset from 'babel-preset-minify';\nimport bannerPlugin from '@comandeer/babel-plugin-banner';\nimport { getCommentContent } from '@comandeer/babel-plugin-banner/utils';\nimport { transform } from 'babel-core';\n\nconst deprecate = depd( 'rollup-plugin-babel-minify' );\n\nfunction minify( options = {} ) {\n\tlet rollupBanner;\n\n\tif ( !checkNodeVersion() ) {\n\t\tdeprecate( 'This plugin will remove support for Node <6 in version 5.0.0.' );\n\t}\n\n\treturn {\n\t\tname: 'babel-minify',\n\n\t\toptions( { banner } ) {\n\t\t\trollupBanner = banner;\n\t\t},\n\n\t\ttransformBundle( bundle, { banner: bundleBanner } ) {\n\t\t\tconst minifyOptions = filterMinifyOptions( options );\n\t\t\tconst babelConf = {\n\t\t\t\tpresets: [ [ minifyPreset, minifyOptions ] ],\n\t\t\t\tsourceMaps: typeof options.sourceMap !== 'undefined' ? Boolean( options.sourceMap ) : true,\n\t\t\t\tcomments: typeof options.comments !== 'undefined' ? Boolean( options.comments ) : true\n\t\t\t};\n\n\t\t\tif ( isFnOrString( options.banner ) || isFnOrString ( bundleBanner ) || isFnOrString ( rollupBanner ) ) {\n\t\t\t\tlet banner = options.banner || bundleBanner || rollupBanner;\n\t\t\t\tbanner = isFn ( banner ) ? banner() : banner;\n\t\t\t\tconst bannerContent = getCommentContent( banner );\n\t\t\t\tlet isAlreadyInserted = false;\n\n\t\t\t\tbabelConf.plugins = [\n\t\t\t\t\t[ bannerPlugin, {\n\t\t\t\t\t\tbanner\n\t\t\t\t\t} ]\n\t\t\t\t];\n\n\t\t\t\tif ( !babelConf.comments ) {\n\t\t\t\t\tbabelConf.shouldPrintComment = ( comment ) => {\n\t\t\t\t\t\tif ( !isAlreadyInserted && comment === bannerContent ) {\n\t\t\t\t\t\t\tisAlreadyInserted = true;\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet { code, map } = transform( bundle, babelConf );\n\n\t\t\tif ( options.bannerNewLine ) {\n\t\t\t\t( { code, map } = addNewLine( code ) );\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tcode,\n\t\t\t\tmap\n\t\t\t};\n\t\t}\n\t};\n}\n\nexport default minify;\n"],"names":["addNewLine","magicString","MagicString","bannerEnd","code","indexOf","appendRight","map","generateMap","toString","filterMinifyOptions","disallowedProperties","minifyOptions","keys","filter","options","isString","v","isFn","isFnOrString","checkNodeVersion","semver","satisfies","process","version","deprecate","depd","minify","rollupBanner","banner","bundleBanner","babelConf","minifyPreset","sourceMap","comments","bannerContent","getCommentContent","isAlreadyInserted","plugins","bannerPlugin","shouldPrintComment","comment","transform","bannerNewLine"],"mappings":"iiBAGA,QAASA,WAAT,GAA4B,IACrBC,GAAc,GAAIC,YAAJ,IACdC,EAAYC,EAAKC,OAALD,CAAc,IAAdA,IAENE,YAAaH,EAAY,EAAG,KAJb,IAMrBI,GAAMN,EAAYO,WAAZP,CAAyB,kBAAA,CAAzBA,QAIL,MACAA,EAAYQ,QAAZR,EADA,MAAA,EAMR,QAASS,oBAAT,GAAwC,IACjCC,qDAMAC,mBAECC,QAAgBC,OAAQ,WAAc,CACI,CAAC,CAA5CH,KAAqBN,OAArBM,GADuC,QAEjBI,IAFiB,CAA7C,KASD,QAASC,SAAT,GAAuB,OACV,KAALC,KAA0B,QAAb,WAGrB,QAASC,KAAT,GAAmB,OACN,KAALD,KAA0B,UAAb,WAGrB,QAASE,aAAT,GAA2B,OACnBH,cAAiBE,QAGzB,QAASE,iBAAT,EAA4B,OACpBC,QAAOC,SAAPD,CAAkBE,QAAQC,OAA1BH,CAAmC,SAAnCA,EChDR,GAWMI,WAAYC,KAAM,4BAANA,CAXlB,CAaA,QAASC,OAAT,EAAgC,IAC3BC,GADYb,kEAGVK,+BACM,iEAGL,MACA,cADA,WAGgB,IAAXS,KAAAA,UAHL,CAAA,qBAO8C,IAAjBC,KAARD,OACpBjB,EAAgBF,uBAChBqB,EAAY,SACR,CAAE,CAAEC,YAAF,GAAF,CADQ,YAEwB,WAA7B,QAAOjB,GAAQkB,aAAqClB,EAAQkB,SAFvD,UAGqB,WAA5B,QAAOlB,GAAQmB,YAAoCnB,EAAQmB,QAHpD,KAMbf,aAAcJ,EAAQc,MAAtBV,GAAkCA,eAAlCA,EAAmEA,gBAAgC,IACnGU,GAASd,EAAQc,MAARd,SACJG,QAAkBW,GAAlBX,EAF8F,IAGjGiB,GAAgBC,uBAAAA,IAClBC,OAEMC,QAAU,CACnB,CAAEC,YAAF,CAAgB,SAAA,CAAhB,CADmB,CANmF,CAYjGR,EAAUG,QAZuF,KAa5FM,mBAAqB,WAAe,OACxC,IAAsBC,KADkB,SAAA,IAA9C,CAbsG,QAyBpFC,mBAAAA,MAAdtC,IAAAA,KAAMG,IAAAA,OAEPQ,EAAQ4B,cAAgB,OACV3C,kBAAdI,IADwB,KAClBG,UAGJ,OAAA,MAAA,EA9CF"}