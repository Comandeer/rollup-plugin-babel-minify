{"version":3,"file":"rollup-plugin-babili.js","sources":["../src/utils.js","../src/index.js"],"sourcesContent":["'use strict';\n\nfunction filterBabiliOptions( options ) {\n\tconst disallowedProperties = [\n\t\t'banner',\n\t\t'sourceMap',\n\t\t'comments'\n\t];\n\tconst babiliOptions = {};\n\n\tObject.keys( options ).filter( ( option ) => {\n\t\tif ( disallowedProperties.indexOf( option ) === -1 ) {\n\t\t\tbabiliOptions[ option ] = options[ option ];\n\t\t}\n\t} );\n\n\treturn babiliOptions;\n}\n\nfunction isString( v ) {\n\treturn v != null && typeof v === 'string';\n}\n\nfunction isFn( v ) {\n\treturn v != null && typeof v === 'function';\n}\n\nfunction isFnOrString( v ) {\n\treturn isString( v ) || isFn( v );\n}\n\nexport { filterBabiliOptions };\nexport { isString };\nexport { isFn };\nexport { isFnOrString };\n","'use strict';\n\nimport { filterBabiliOptions } from './utils.js';\nimport { isFn } from './utils.js';\nimport { isFnOrString } from './utils.js';\nimport babiliPreset from 'babel-preset-babili';\nimport bannerPlugin from '@comandeer/babel-plugin-banner';\nimport { getCommentContent } from '@comandeer/babel-plugin-banner/utils';\nimport { transform } from 'babel-core';\n\nfunction babili( options = {} ) {\n\tlet rollupBanner;\n\n\treturn {\n\t\tname: 'babili',\n\n\t\toptions( { banner } ) {\n\t\t\trollupBanner = banner;\n\t\t},\n\n\t\ttransformBundle( bundle ) {\n\t\t\tconst babiliOptions = filterBabiliOptions( options );\n\t\t\tconst babelConf = {\n\t\t\t\tpresets: [ [ babiliPreset, babiliOptions ] ],\n\t\t\t\tsourceMaps: typeof options.sourceMap !== 'undefined' ? Boolean( options.sourceMap ) : true,\n\t\t\t\tcomments: typeof options.comments !== 'undefined' ? Boolean( options.comments ) : true\n\t\t\t};\n\n\t\t\tif ( isFnOrString( options.banner ) || isFnOrString ( rollupBanner ) ) {\n\t\t\t\tlet banner = options.banner || rollupBanner;\n\t\t\t\tbanner = isFn ( banner ) ? banner() : banner;\n\t\t\t\tconst bannerContent = getCommentContent( banner );\n\t\t\t\tlet isAlreadyInserted = false;\n\n\t\t\t\tbabelConf.plugins = [\n\t\t\t\t\t[ bannerPlugin, {\n\t\t\t\t\t\tbanner\n\t\t\t\t\t} ]\n\t\t\t\t];\n\n\t\t\t\tif ( !babelConf.comments ) {\n\t\t\t\t\tbabelConf.shouldPrintComment = ( comment ) => {\n\t\t\t\t\t\tif ( !isAlreadyInserted && comment === bannerContent ) {\n\t\t\t\t\t\t\tisAlreadyInserted = true;\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst { code, map } = transform( bundle, babelConf );\n\n\t\t\treturn {\n\t\t\t\tcode,\n\t\t\t\tmap\n\t\t\t};\n\t\t}\n\t};\n}\n\nexport default babili;\n"],"names":["filterBabiliOptions","options","disallowedProperties","babiliOptions","keys","filter","option","indexOf","isString","v","isFn","isFnOrString","babili","rollupBanner","banner","bundle","babelConf","babiliPreset","sourceMap","Boolean","comments","bannerContent","getCommentContent","isAlreadyInserted","plugins","bannerPlugin","shouldPrintComment","comment","transform","code","map"],"mappings":";iGAEA,QAASA,qBAAqBC,MACvBC,IACL,SACA,YACA,YAEKC,mBAECC,KAAMH,GAAUI,OAAQ,SAAEC,IACiB,IAA5CJ,EAAqBK,QAASD,OACnBA,GAAWL,EAASK,MAI9BH,EAGR,QAASK,UAAUC,SACN,OAALA,GAA0B,gBAANA,GAG5B,QAASC,MAAMD,SACF,OAALA,GAA0B,kBAANA,GAG5B,QAASE,cAAcF,SACfD,UAAUC,IAAOC,KAAMD,GClB/B,QAASG,aAAQX,6DACZY,qBAGG,gCAEKC,KAAAA,SACKA,4BAGCC,MACVZ,GAAgBH,oBAAqBC,GACrCe,aACQC,aAAcd,mBACc,KAAtBF,EAAQiB,WAA4BC,QAASlB,EAAQiB,wBAClC,KAArBjB,EAAQmB,UAA2BD,QAASlB,EAAQmB,cAGjET,aAAcV,EAAQa,SAAYH,aAAeE,GAAiB,IAClEC,GAASb,EAAQa,QAAUD,IACtBH,KAAOI,GAAWA,IAAWA,KAChCO,GAAgBC,qDAAmBR,GACrCS,GAAoB,IAEdC,UACPC,0BAKGT,EAAUI,aACLM,mBAAqB,SAAEC,UAC1BJ,GAAqBI,IAAYN,OAClB,GAEb,WAQWO,oBAAWb,EAAQC,iBAAjCa,WAAMC"}