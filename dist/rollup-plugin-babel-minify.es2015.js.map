{"version":3,"file":"rollup-plugin-babel-minify.es2015.js","sources":["../src/utils.js","../src/index.js"],"sourcesContent":["import MagicString from 'magic-string';\nimport semver from 'semver';\n\nfunction addNewLine( code ) {\n\tconst magicString = new MagicString( code );\n\tconst bannerEnd = code.indexOf( '*/' );\n\n\tmagicString.appendRight( bannerEnd + 2, '\\n' );\n\n\tconst map = magicString.generateMap( {\n\t\tincludeContent: true\n\t} );\n\n\treturn {\n\t\tcode: magicString.toString(),\n\t\tmap\n\t};\n}\n\nfunction filterMinifyOptions( options ) {\n\tconst disallowedProperties = [\n\t\t'banner',\n\t\t'bannerNewLine',\n\t\t'sourceMap',\n\t\t'comments'\n\t];\n\tconst minifyOptions = {};\n\n\tObject.keys( options ).filter( ( option ) => {\n\t\tif ( disallowedProperties.indexOf( option ) === -1 ) {\n\t\t\tminifyOptions[ option ] = options[ option ];\n\t\t}\n\t} );\n\n\treturn minifyOptions;\n}\n\nfunction isString( v ) {\n\treturn v != null && typeof v === 'string';\n}\n\nfunction isFn( v ) {\n\treturn v != null && typeof v === 'function';\n}\n\nfunction isFnOrString( v ) {\n\treturn isString( v ) || isFn( v );\n}\n\nfunction checkNodeVersion() {\n\treturn semver.satisfies( process.version, '>=6.0.0' );\n}\n\nexport { addNewLine };\nexport { filterMinifyOptions };\nexport { isString };\nexport { isFn };\nexport { isFnOrString };\nexport { checkNodeVersion };\n","'use strict';\n\nimport { filterMinifyOptions } from './utils.js';\nimport { addNewLine } from './utils.js';\nimport { isFn } from './utils.js';\nimport { isFnOrString } from './utils.js';\nimport { checkNodeVersion } from './utils.js';\nimport depd from 'depd';\nimport minifyPreset from 'babel-preset-minify';\nimport bannerPlugin from '@comandeer/babel-plugin-banner';\nimport { getCommentContent } from '@comandeer/babel-plugin-banner/utils';\nimport { transform } from 'babel-core';\n\nconst deprecate = depd( 'rollup-plugin-babel-minify' );\n\nfunction minify( options = {} ) {\n\tlet rollupBanner;\n\n\tif ( !checkNodeVersion() ) {\n\t\tdeprecate( 'This plugin will remove support for Node <6 in version 5.0.0.' );\n\t}\n\n\treturn {\n\t\tname: 'babel-minify',\n\n\t\toptions( { banner } ) {\n\t\t\trollupBanner = banner;\n\t\t},\n\n\t\ttransformBundle( bundle, { banner: bundleBanner } ) {\n\t\t\tconst minifyOptions = filterMinifyOptions( options );\n\t\t\tconst babelConf = {\n\t\t\t\tpresets: [ [ minifyPreset, minifyOptions ] ],\n\t\t\t\tsourceMaps: typeof options.sourceMap !== 'undefined' ? Boolean( options.sourceMap ) : true,\n\t\t\t\tcomments: typeof options.comments !== 'undefined' ? Boolean( options.comments ) : true\n\t\t\t};\n\n\t\t\tif ( isFnOrString( options.banner ) || isFnOrString ( bundleBanner ) || isFnOrString ( rollupBanner ) ) {\n\t\t\t\tlet banner = options.banner || bundleBanner || rollupBanner;\n\t\t\t\tbanner = isFn ( banner ) ? banner() : banner;\n\t\t\t\tconst bannerContent = getCommentContent( banner );\n\t\t\t\tlet isAlreadyInserted = false;\n\n\t\t\t\tbabelConf.plugins = [\n\t\t\t\t\t[ bannerPlugin, {\n\t\t\t\t\t\tbanner\n\t\t\t\t\t} ]\n\t\t\t\t];\n\n\t\t\t\tif ( !babelConf.comments ) {\n\t\t\t\t\tbabelConf.shouldPrintComment = ( comment ) => {\n\t\t\t\t\t\tif ( !isAlreadyInserted && comment === bannerContent ) {\n\t\t\t\t\t\t\tisAlreadyInserted = true;\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet { code, map } = transform( bundle, babelConf );\n\n\t\t\tif ( options.bannerNewLine ) {\n\t\t\t\t( { code, map } = addNewLine( code ) );\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tcode,\n\t\t\t\tmap\n\t\t\t};\n\t\t}\n\t};\n}\n\nexport default minify;\n"],"names":["addNewLine","MagicString","indexOf","appendRight","generateMap","includeContent","code","toString","map","filterMinifyOptions","Object","keys","filter","isString","isFn","isFnOrString","checkNodeVersion","semver","satisfies","process","version","deprecate","depd","minify","name","options","banner","transformBundle","presets","minifyPreset","sourceMaps","sourceMap","comments","getCommentContent","plugins","bannerPlugin","shouldPrintComment","transform","bannerNewLine"],"mappings":"8XAGA,QAASA,WAAT,GAA4B,CAC3B,KAAM,GAAc,GAAIC,YAAJ,GAApB,CACM,EAAY,EAAKC,OAAL,CAAc,IAAd,CADlB,CAGA,EAAYC,WAAZ,CAAyB,EAAY,CAArC,CAAwC,IAAxC,CAJ2B,CAM3B,KAAM,GAAM,EAAYC,WAAZ,CAAyB,CACpCC,iBADoC,CAAzB,CAAZ,CAIA,MAAO,CACNC,KAAM,EAAYC,QAAZ,EADA,CAENC,KAFM,CAIP,CAED,QAASC,oBAAT,GAAwC,CACvC,KAAM,oDAAN,CAMM,IANN,CAcA,MANAC,QAAOC,IAAP,IAAuBC,MAAvB,CAA+B,KAAc,CACI,CAAC,CAA5C,KAAqBV,OAArB,GADuC,GAE3C,KAA0B,IAFiB,CAI5C,CAJD,CAMA,EACA,CAED,QAASW,SAAT,GAAuB,CACtB,MAAY,KAAL,KAA0B,QAAb,UACpB,CAED,QAASC,KAAT,GAAmB,CAClB,MAAY,KAAL,KAA0B,UAAb,UACpB,CAED,QAASC,aAAT,GAA2B,CAC1B,MAAOF,cAAiBC,OACxB,CAED,QAASE,iBAAT,EAA4B,CAC3B,MAAOC,QAAOC,SAAP,CAAkBC,QAAQC,OAA1B,CAAmC,SAAnC,CACP,CCjDD,KAWMC,WAAYC,KAAM,4BAAN,CAXlB,CAaA,QAASC,OAAT,CAAiB,IAAjB,CAAgC,CAC/B,GAAI,EAAJ,CAMA,MAJMP,mBAIN,EAHCK,UAAW,+DAAX,CAGD,CAAO,CACNG,KAAM,cADA,CAGNC,QAAS,CAAEC,QAAF,CAAT,CAAsB,CACrB,GACA,CALK,CAONC,kBAAyB,CAAED,QAAF,CAAzB,CAAoD,CACnD,KAAM,GAAgBjB,sBAAtB,CACM,EAAY,CACjBmB,QAAS,CAAE,CAAEC,YAAF,GAAF,CADQ,CAEjBC,WAAyC,WAA7B,QAAO,GAAQC,SAA3B,IAAgE,EAAQA,SAFvD,CAGjBC,SAAsC,WAA5B,QAAO,GAAQA,QAAzB,IAA6D,EAAQA,QAHpD,CADlB,CAOA,GAAKjB,aAAc,EAAQW,MAAtB,GAAkCX,eAAlC,EAAmEA,eAAxE,CAAwG,CACvG,GAAI,GAAS,EAAQW,MAAR,MAAb,CACA,EAASZ,QAAkB,GAAlB,EAF8F,CAGvG,KAAM,GAAgBmB,oBAAtB,CACA,GAAI,KAAJ,CAEA,EAAUC,OAAV,CAAoB,CACnB,CAAEC,YAAF,CAAgB,CACfT,QADe,CAAhB,CADmB,CANmF,CAYjG,EAAUM,QAZuF,GAatG,EAAUI,kBAAV,CAA+B,KACzB,GAAsB,KADG,KAE7B,IAF6B,IAbuE,CAuBvG,CAED,GAAI,CAAE9B,MAAF,CAAQE,KAAR,EAAgB6B,cAApB,CAMA,MAJK,GAAQC,aAIb,GAHG,CAAEhC,MAAF,CAAQE,KAAR,EAAgBR,aAGnB,EAAO,CACNM,MADM,CAENE,KAFM,CAIP,CAlDK,CAoDP"}